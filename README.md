# LD-hdd
LSX-Dodgers HDD Controller

# 概要
LD-hdd は、X1用のOS、LSX-DodgersにてHDDを扱うためのプログラムです。
実HDDには対応しておらず、エミュレータ、または、BulePill基板を内蔵したSASIカードでの運用を想定しています。

# 使い方
```
  hdd [hdd drive] [offset] [target drive]
    hdd drive:    0 - 3(HD0～HD3) 割り当てるハードディスク番号
    offset:       2MBごとのインデックス(1で2MBの位置、2で4MBの位置を先頭として処理する)
    target drive: A-H 割り当て先のドライブ(デフォルト H)。「:」は必要ないので注意。
```

初回起動で 0xc900 から常駐します。アドレス固定なため、他の常駐プログラムを先に常駐させていると挙動がおかしくなるので、起動直後に実行してください。

実行に成功すると、target driveで指定したドライブ(指定しない場合はH:ドライブ)がHDD用のドライブとして割り当てられます。

ドライブ番号は0から3で、オフセットはHDDを2MBの領域で区切った何番目の領域を使うか、という指定になります。
通常は10MBのHDDについて、オフセット0～4を指定し、5分割して使うような想定です。

また、Ver 0.06からWindowsのVHD形式に対応しています。

参考→ [WindowsでのVHDファイルの作り方](https://github.com/tablacus/LSX-Dodgers/issues/4)

VHDファイルをHDDとして割り当てた場合は、VHD内のBPB(BIOS Parameter Block)からDPB情報を設定するため、サイズの違うHDDを柔軟に扱えます。
VHDファイルを使う場合、パラメータのoffset値は0を指定してください。
また、基本的にはVHDファイルを使う運用を行い、offset指定での運用は避けるようにしてください(近日削除される可能性が高いです)。

常駐後、引数を与えて実行する事で、割り当て先ドライブのハードディスクドライブ番号とオフセットを変更出来ます。

複数のtarget driveに対して実行する事で、複数ドライブにHDDを割り当て可能です。

# VHD形式ではない時のHDDマップ(参考)
```
0x0000 -   0x03ff : 予備領域(1KB)
0x0400 -   0x0fff : FAT(3KB)
0x1000 -   0x13ff : 空き(予備？1KB)
0x1400 -   0x2bff : ルートディレクトリ領域(5KB)
0x2c00 - 0x1fffff : データ格納領域(2MB - 11KB)
```

# 謝辞
X1用のSASIドライバは [すーぱーたーぼ @SuperturboZ](https://twitter.com/SuperturboZ) さんの手によるものです。SASIドライバがなければこのプログラムは存在しませんでした。ありがとうございます。

# History
* Version 0.07 (2022/8/24)
  * LSX-Dodgers 1.35以上推奨
  * FAT16対応(512MBまで対応)
* Version 0.06 (2022/8/19)
  * LSX-Dodgers 1.32以上必須
  * VHD形式に対応し、情報をBPBから取得するよう対応(BPBが得られない場合は従来と同様の挙動になります)
  * デフォルトドライブを H: に変更
  * (内部的な変更)論理セクタサイズを512バイトに変更
* Version 0.05 (2022/8/11)
  * 割り当て先ドライブの指定に対応
* Version 0.03 (2022/8/9)
  * LSX-Dodgers 1.29に対応(挙動は変わりません)
* Version 0.02 (2022/8/1)
  * アクセス先ドライブが不定になり正常にHDDを読み書き出来ない問題を仮修正
    * 内部ドライブを強制的にFドライブに固定する事で不具合を暫定回避しました
  * HDD用DPBの調整(セクタ読み書き処理のアドレスを0にしてデフォルトルーチンを使うよう設定)
  * Z80アセンブラ AILZ80ASM に対応( build_ailz80.bat を実行)
* Version 0.01 (2022/8/1)
  * 初版
