# LD-hdd
LSX-Dodgers HDD Controller

# 概要
LD-hdd は、X1用のOS、LSX-DodgersにてHDDを扱うためのプログラムです。
実HDDには対応しておらず、エミュレータ、または、BulePill基板を内蔵したSASIカードでの運用を想定しています。

# 使い方
```
  hdd [[drive] [offset]]
    drive:  0 - 3(HD0～HD3)
    offset: 2MBごとのインデックス(1で2MBの位置、2で4MBの位置を先頭として処理する)
```

初回起動で 0xc900 から常駐します。アドレス固定なため、他の常駐プログラムを先に常駐させていると挙動がおかしくなるので、起動直後に実行してください。

常駐に成功すると、本来バンクメモリ用のドライブであるF:ドライブがHDD用のドライブとして割り当てられます。

ドライブ番号は0から3で、オフセットはHDDを2MBの領域で区切った何番目の領域を使うか、という指定になります。
通常は10MBのHDDについて、オフセット0～4を指定し、5分割して使うような想定です。

常駐後、引数を与えて実行する事で、ドライブ、オフセットを変更出来ます。

# HDDマップ(参考)
```
0x0000 -   0x03ff : 予備領域(1KB)
0x0400 -   0x0fff : FAT(3KB)
0x1000 -   0x13ff : 空き(予備？1KB)
0x1400 -   0x2bff : ルートディレクトリ領域(5KB)
0x2c00 - 0x1fffff : データ格納領域(2MB - 11KB)
```

# 謝辞
X1用のSASIドライバは [すーぱーたーぼ @SuperturboZ](https://twitter.com/SuperturboZ) さんの手によるものです。SASIドライバがなければこのプログラムは存在しませんでした。ありがとうございます。

# History

* Version 0.02 (2022/8/1)
  * アクセス先ドライブが不定になり正常にHDDを読み書き出来ない問題を仮修正
    * 内部ドライブを強制的にFドライブに固定する事で不具合を暫定回避しました
  * HDD用DPBの調整(セクタ読み書き処理のアドレスを0にしてデフォルトルーチンを使うよう設定)
  * Z80アセンブラ AILZ80ASM に対応( build_ailz80.bat を実行)
* Version 0.01 (2022/8/1)
  * 初版
