# LSX-DodgersをX1のHDDからブートさせる手順

## 任意のサイズのVHDファイルを作成する
[こちらのVHDの作り方のページ](https://github.com/tablacus/LSX-Dodgers/issues/4) を参考に、任意のサイズのVHDファイルを作成します。
VHDファイルは「HDDBASE.VHD」として当フォルダに保存します。これが、HDDブートさせるHDDの元データになります。

※当方では128MBのVHDファイルで確認しています。

## HDD.COMを含むLD.BINをエミュレータのディスクイメージ内に作成する

※当フォルダには、LSX-Dodgers 1.61 + LD-hdd(hdd.com) 0.13のディスクイメージが既に入っていますので、そのバージョンで良い場合はこの項目は飛ばしてください。LSX-Dodgersまたはhdd.com(LD-hdd)を更新したい場合のみ、こちらの手順を行ってください。

最新のLSX-DodgersをエミュレーターのAドライブ、当フォルダにある「MKLDHD.d88」をBドライブに入れて起動します(ディスクイメージファイルのコピーなどはせず、当フォルダのファイルをそのままマウントしてください)。
MKLDHD.d88には LD-hdd (hdd.com) のv0.13が入っていますので、もし更新したい場合は、事前にhdd.comの更新を行ってください。

続いてエミュレーター上で下記のように入力します(Bドライブに移動してからMKLDHD.BATを実行)。

```
B:
MKLDHD
```

これにより、BドライブにLD.BINが出力されますので、出力された事を確認してからエミュレーターを終了してください。


## 作成バッチ(スクリプト)を実行する
Windowsの場合はmkldhdd.bat、それ以外の場合はmkldhdd.shを実行すると、内部で下記の手順を実行し、LSX-Dodgersの起動HDDイメージが作成されます。

1. MKLDHD.d88の中からLD.BINを抜き出す
2. ldhdd_boot.asmをアセンブルして、IPL部分のバイナリ(ldhdd_boot.bin)を作成する
3. HDDBASE.vhdとldhdd_boot.binを混ぜて、LDHDD.vhdを作成する

3で出力されたLDHDD.vhdが、起動可能なHDDイメージになります。

HDDイメージ内には1ファイルも入っていない状態ですので、任意の方法でお好きなファイルを書き込んでお使いください。

※作成バッチの実行には、[ndc](https://euee.web.fc2.com/tool/tool.html)、[AILZ80ASM](https://github.com/AILight/AILZ80ASM)、pythonが必要です。それぞれにパスを通すか、バッチのあるフォルダにndcとAILZ80ASMの実行ファイルを置いてからバッチを実行してください(バッチファイルの冒頭のNDCPATH、AILZPATH、PYTHONPATHに、それぞれの実行ファイルのフルパスを記載しても問題ありません)。


## HDD1から起動させる方法
デフォルトではHDD0から起動を行いますが、 当フォルダに含まれるMKLDHD1.d88 を MKLDHD.d88 にリネームして使用する事で、HDD1から起動するHDD起動イメージを作成出来ます(元のMKLDHD.d88は、MKLDHD0.d88など、テキトーな名前にリネームしておいてください)。

MKLDHD1.d88 の中には、通常のLD-hddとは別の、実行するとHDD1を自動でマウントするHDD1.COMというコマンドが含まれており、MKLDHD1.d88の中のLD.BINについては、こちらを適用した、HDD1を自動マウントするLSX-Dodgersが入っています。

若干微妙な方法ではありますが、とりあえずHDD0/HDD1でそれぞれ起動したい場合はこちらの方法をお使いください(何かもっと良い方法が思い付いたらどうにかします)。

## 既存のHDDイメージに含まれるHDブート用のLSX-Dodgersを更新したい場合
LSX-Dodgersがバージョンアップした場合など、HDDから起動するLSX-Dodgersを更新したい場合は、現在お使いのHDDイメージをコピーした上で「HDDBASE.vhd」にリネームし、当フォルダに置いた上で、「作成バッチ(スクリプト)を実行する」の項目を実行してください。HDDの中身は変わらず、起動するLSX-Dodgersのみバージョンアップ出来ます。

基本的には問題ないとは思いますが、最悪の場合はHDDイメージを破壊しますので、必ずバックアップをとってから行ってください。
